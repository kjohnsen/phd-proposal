<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Towards Optogenetic Feedback Control of Neural Population Dynamics - 4&nbsp; Aim 1 - A CLOC simulation testbed</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../src/aim2.html" rel="next">
<link href="../src/background.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Aim 1 - A CLOC simulation testbed</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Towards Optogenetic Feedback Control of Neural Population Dynamics</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/kjohnsen/phd-proposal/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="../Towards-Optogenetic-Feedback-Control-of-Neural-Population-Dynamics.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/specific-aims.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Specific Aims</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/background.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Background</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/aim1.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Aim 1 - A CLOC simulation testbed</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/aim2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Aim 2 - Multi-input CLOC</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/aim3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Aim 3 - Control of latent population dynamics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/timeline.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Proposed timeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#rationale" id="toc-rationale" class="nav-link active" data-scroll-target="#rationale">Rationale</a>
  <ul>
  <li><a href="#innovation" id="toc-innovation" class="nav-link" data-scroll-target="#innovation">Innovation</a></li>
  </ul></li>
  <li><a href="#approach" id="toc-approach" class="nav-link" data-scroll-target="#approach">Approach</a>
  <ul>
  <li><a href="#guiding-principles" id="toc-guiding-principles" class="nav-link" data-scroll-target="#guiding-principles">Guiding principles</a></li>
  <li><a href="#sec-cleo-arch" id="toc-sec-cleo-arch" class="nav-link" data-scroll-target="#sec-cleo-arch">Closed-loop simulation architecture</a></li>
  <li><a href="#sec-elec" id="toc-sec-elec" class="nav-link" data-scroll-target="#sec-elec">Electrode recording</a></li>
  <li><a href="#optogenetic-stimulation" id="toc-optogenetic-stimulation" class="nav-link" data-scroll-target="#optogenetic-stimulation">Optogenetic stimulation</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul>
  <li><a href="#model-validation" id="toc-model-validation" class="nav-link" data-scroll-target="#model-validation">Model validation</a></li>
  <li><a href="#sec-cleo-experiments" id="toc-sec-cleo-experiments" class="nav-link" data-scroll-target="#sec-cleo-experiments">Example experiments</a></li>
  </ul></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  <li><a href="#summary-of-contributions" id="toc-summary-of-contributions" class="nav-link" data-scroll-target="#summary-of-contributions">Summary of contributions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-aim1" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Aim 1 - A CLOC simulation testbed</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="rationale" class="level2">
<h2 class="anchored" data-anchor-id="rationale">Rationale</h2>
<p>CLOC experiments can be difficult and costly, posing a barrier to entry for neuroscientists that find CLOC’s advantages attractive. Their lab might lack the funds or time to invest in hardware and software infrastructure or the confidence that such an investment would yield successful experiments. Moreover, when the proposed experiment requires signal processing/control method development, iterating on designs <em>in-vivo</em> may be cumbersome, given the additional cost of animal care and training. However, these costs and risks can be mitigated through <em>in-silico</em> prototyping. Given a reliable model of the system of interest, one can simulate an experiment and assess its effectiveness. Alternate models of a system can be tested to assess robustness of a method to unknown model properties, or that method can be validated on a variety of systems to determine its general applicability. This strategy not only allows for a researcher to evaluate and optimize methods before committing significant resources to them, but also accelerates the development cycle.</p>
<section id="innovation" class="level3">
<h3 class="anchored" data-anchor-id="innovation">Innovation</h3>
<p>For these reasons, I have developed Cleo: Closed Loop, Electrophysiology, and Optogenetics experiment simulation testbed. Unlike existing software, Cleo simultaneously provides a high-level interface to fast and flexible neural network simulations; easy, model-independent injection of electrode recording and optogenetic perturbations; and a real-time, closed-loop processing module capable of modeling communication and processing delays inherent in real experiments. I thus provide a low-cost environment to design and develop CLOC methods, as well as for researchers to see if CLOC may serve their research agenda.</p>
</section>
</section>
<section id="approach" class="level2">
<h2 class="anchored" data-anchor-id="approach">Approach</h2>
<section id="guiding-principles" class="level3">
<h3 class="anchored" data-anchor-id="guiding-principles">Guiding principles</h3>
<p>Two factors drove our choice of recording and stimulation models to integrate into Cleo. First, because a main purpose of Cleo is to enable prototyping of experiments, we focused on models at the level of the parameters an experimenter is able to alter—this led us to choose models embedded in physical, 3D space. Second, we assumed that highly realistic models of individual neurons are not needed to capture most mesoscale-level phenomena. Accordingly, Cleo was developed with the intention of using point neurons models, rather than multi-compartment neuron models with realistic morphologies.</p>
<p>In addition to our modeling priorities, the goals of usability and extensibility guided our choices in software dependencies and infrastructure. Ease of use is important to make Cleo as accessible as possible to researchers with varied backgrounds, and motivated Cleo’s modular design, which allows users to add different recording or stimulation devices with little or no modification to the underlying network model. Additionally, extensibility is important for the testbed to remain relevant under changing needs in the future, allowing for new functionality to be easily added in a “plug-in,” modular architecture.</p>
</section>
<section id="sec-cleo-arch" class="level3">
<h3 class="anchored" data-anchor-id="sec-cleo-arch">Closed-loop simulation architecture</h3>
<div id="fig-cleo-arch" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><a href="img/cleo-arch.png" class="lightbox" title="A conceptual diagram of Cleo’s functionality. Cleo wraps a Brian network model, injects stimulation and recording devices, and interfaces with the network in real time through a simulated “I/O processor”." data-gallery="quarto-lightbox-gallery-1"><img src="img/cleo-arch.png" class="img-fluid figure-img"></a></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: A conceptual diagram of Cleo’s functionality. Cleo wraps a Brian network model, injects stimulation and recording devices, and interfaces with the network in real time through a simulated “I/O processor”.</figcaption><p></p>
</figure>
</div>
<p>We chose Brian 2 <span class="citation" data-cites="stimberg19">(<a href="references.html#ref-stimberg19" role="doc-biblioref"><em>1</em></a>)</span> as the spiking neural network simulator to build Cleo around. Brian has the advantages of being flexible and intuitive, where models are defined with user-provided mathematical equations. Moreover, it is written in Python, an open-source, intuitive language <span class="citation" data-cites="bogdanchikov13">(<a href="references.html#ref-bogdanchikov13" role="doc-biblioref"><em>2</em></a>)</span> widely used in computational neuroscience <span class="citation" data-cites="davison09 muller15">(<a href="references.html#ref-davison09" role="doc-biblioref"><em>3</em></a>, <a href="references.html#ref-muller15" role="doc-biblioref"><em>4</em></a>)</span>—users do not need to use any other languages to use Brian and Cleo. Brian is also relatively fast (especially since it is developed primarily for point neuron simulations), as shown in benchmarks <span class="citation" data-cites="stimberg19">(<a href="references.html#ref-stimberg19" role="doc-biblioref"><em>1</em></a>)</span>.</p>
<p>Cleo provides three modules—recording, stimulation, and closed-loop processing—for integration with an existing Brian model (see <a href="#fig-cleo-arch">Figure&nbsp;<span>4.1</span></a>). Cleo’s functionality centers around a <code>CLSimulator</code> object that orchestrates the interactions between these three modules and the Brian simulation by injecting devices, running the simulation, and communicating with an <code>IOProcessor</code> object at each time step. The <code>IOProcessor</code> receives recorder measurements according to a specified sampling rate and returns any updates to stimulator devices. To simulate the effects of latency in closed-loop control, Cleo provides a <code>LatencyIOProcessor</code> class which stores control signals in a buffer to later deliver them after an arbitrary delay. <!-- It does this by storing the outputs calculated for every sample in a buffer along with the time they can be delivered to the network.
For example, if a sample is taken at 20 ms and the user wishes to simulate a processing and communication latency of 3 ms, the control signal, along with the output time of 23 ms is stored in a buffer which the simulation checks at every timestep.
As soon as the simulation clock reaches 23 ms, the control signal is taken from the buffer and applied to the stimulator devices.
Because the user has arbitrary control over this latency, they can easily simulate probabilistic delays if, for example, they wish to assess the effect of the experimental platform stalling occasionally. --></p>
<!-- By default, `LatencyIOProcessor` samples on a fixed schedule and simulates processing samples in parallel—that is, the computation time for one sample does not affect that of others.
Some alternatives are available, as illustrated in @fig-latency.

::: {#fig-latency}
![](img/fig-latency.png)

Latency emulation strategy and available configurations. (A) Cleo registers the time a sample is taken from the recording devices, the times the computation starts and ends, applying the user-specified delay, and updates stimulation devices when finished. (B) The default, parallel processing/fixed sampling mode. (C) The serial processing/fixed sampling case reflects when computations are not performed in parallel, but sampling continues on a fixed schedule. (D) The final processing mode avoids buffer overflow by sampling only once the computation for the previous step has terminated.
::: -->
</section>
<section id="sec-elec" class="level3">
<h3 class="anchored" data-anchor-id="sec-elec">Electrode recording</h3>
<!-- #### Spiking -->
<p>Because we have prioritized point neuron simulations, the electrode functionality currently implemented in Cleo does not rely on raw extracellular potentials, which can only be computed from multi-compartment neurons <span class="citation" data-cites="pettersen12 buzsaki12">(<a href="references.html#ref-pettersen12" role="doc-biblioref"><em>5</em></a>, <a href="references.html#ref-buzsaki12" role="doc-biblioref"><em>6</em></a>)</span>. This biophysical forward modeling approach has been taken in other software <span class="citation" data-cites="hagen18 parasuram16 tomsett15 thornton19">(<a href="references.html#ref-hagen18" role="doc-biblioref"><em>7</em></a>–<a href="references.html#ref-thornton19" role="doc-biblioref"><em>10</em></a>)</span>. To approximate sorted and multi-spike recording without filtering and thresholding of extracellular potentials, Cleo simply takes ground-truth spikes and stochastically determines which to report with probability inversely proportional to distance to the electrode <span class="citation" data-cites="nason20 holt99">(<a href="references.html#ref-nason20" role="doc-biblioref"><em>11</em></a>, <a href="references.html#ref-holt99" role="doc-biblioref"><em>12</em></a>)</span> (see <a href="#fig-elec">Figure&nbsp;<span>4.2</span></a>).</p>
<div id="fig-elec" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/fig-electrodes.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="img/fig-electrodes.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: Illustration of LFP and spiking from Cleo’s electrophysiology module. (A) The probabilistic spike detection model. All spikes within the 100% detection radius, 50% of spikes at the 50% detection radius, and none of those outside the threshold radius are recorded. The detection probability decays with <span class="math inline">\(1/r\)</span>. (B) An example plot generated by Cleo showing the positions of neurons and electrode contacts. (C) Randomly generated spikes for the neurons shown in B. Top: the sorted spike signal, which gives the ground truth source neuron for every spike as a perfect proxy for spike sorting. Bottom: multi-unit spikes, where spikes are reported on every channel they are detected on, regardless of the source neuron. (D) The TKLFP signal generated from the spikes in C for each channel. Y-axis units are not shown.</figcaption><p></p>
</figure>
</div>
<!-- #### LFP -->
<p>In order to approximate cortical LFP without recurring to morphological neurons and biophysical forward modeling, we implemented the kernel LFP approximation from <span class="citation" data-cites="telenczuk20">(<a href="references.html#ref-telenczuk20" role="doc-biblioref"><em>13</em></a>)</span>, which we term TKLFP (Teleńczuk kernel LFP). This method approximates the per-spike contribution to LFP (termed uLFP: unitary LFP) with a delayed Gaussian function, where amplitude and delay depend on the position of the neuron relative to the electrode. <!-- While the original study included reference peak amplitude $A_0$ values at just four cortical depths, we inferred these values for arbitrary depths by performing cubic interpolation on data from their figure 5 and assumed that this profile dropped to zero at 600 µm below the soma and 1000 µm above. --> This implementation is available as a standalone Python package on PyPI <span class="citation" data-cites="johnsen22">(<a href="references.html#ref-johnsen22" role="doc-biblioref"><em>14</em></a>)</span>. Accuracy of this implementation is verified in automated test suites in both TKLFP and Cleo packages.</p>
</section>
<section id="optogenetic-stimulation" class="level3">
<h3 class="anchored" data-anchor-id="optogenetic-stimulation">Optogenetic stimulation</h3>
<!-- #### Light model -->
<p>Cleo simulates optogenetic stimulation by combining a model of light propagation with an opsin model relating light to current. The light model is based on Kubelka-Munk light propagation, operating on the assumption that the medium is optically homogeneous and that particles are larger than the light wavelength <span class="citation" data-cites="foutz12 vo-dinh03">(<a href="references.html#ref-foutz12" role="doc-biblioref"><em>15</em></a>, <a href="references.html#ref-vo-dinh03" role="doc-biblioref"><em>16</em></a>)</span>. Cleo includes absorbance, scattering, and refraction parameters for 473-nm (blue) light as given in <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref"><em>15</em></a>)</span>.</p>
<!-- #### Opsin models -->
<p>Independent of the light propagation model, Cleo provides two different opsin models. One is a four-state Markov model as presented in <span class="citation" data-cites="evans16">(<a href="references.html#ref-evans16" role="doc-biblioref"><em>17</em></a>)</span>, which captures rise, peak, plateau, and fall dynamics as the opsin is activated and deactivated through a Markov process. Additionally, by defining conductance rather than current directly, the model is able to reproduce the photocurrent’s dependence on the membrane potential (see <a href="#fig-opto">Figure&nbsp;<span>4.3</span></a>). <!-- While the four-state model fits experimental data fairly well, the code is structured so that the three- or six-state models in [@evans16] could also be easily implemented. --> Because the Markov model depends on somewhat realistic membrane potential and resistance values, however, it is not well suited for many pre-existing models that do not. To that end, Cleo also provides a simplified model that delivers current (of arbitrary units) proportional to light at the neuron. Users can also specify both the probability that cells of a target population express an opsin and the per-cell expression level.</p>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="model-validation" class="level3">
<h3 class="anchored" data-anchor-id="model-validation">Model validation</h3>
<p>To verify that light and opsin models behaved as expected, we reproduced figures illustrating the optic fiber light transmission profile found in Figure 2a,b of <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref"><em>15</em></a>)</span> and the photocurrent in response to the ramping light intensity from Figure 4c of <span class="citation" data-cites="evans16">(<a href="references.html#ref-evans16" role="doc-biblioref"><em>17</em></a>)</span>. Light intensity-firing rate relationship was qualitatively similar to that originally reported, though differing in some respects due to the use of point neurons rather than morphological neurons. See <a href="#fig-opto">Figure&nbsp;<span>4.3</span></a> for details. Additionally, preliminary experiments show that the simplified, proportional current opsin model is able to produce a firing response qualitatively similar to that of the Markov model.</p>
<div id="fig-opto" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/fig-opto.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="img/fig-opto.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.3: Validation of the optogenetics module. (A) Light transmittance <span class="math inline">\(T\)</span> as a function of radius and axial distance from the optic fiber tip. Transmittance refers to the irradiance <span class="math inline">\(\text{Irr}\)</span> as a proportion of the irradiance at the fiber tip <span class="math inline">\(\text{Irr}_0\)</span>. After Figure 2a from <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref"><em>15</em></a>)</span>. (B) Light transmittance <span class="math inline">\(T\)</span> as a function of distance <span class="math inline">\(z\)</span> straight out from the fiber tip for different optic fiber sizes. After Figure 2b from <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref"><em>15</em></a>)</span>. (C) Photocurrent <span class="math inline">\(I_\text{opto}\)</span> for ramping light of different intensities. After the figure produced by the “ramp” protocol from the default PyRhO simulator <span class="citation" data-cites="evans16">(<a href="references.html#ref-evans16" role="doc-biblioref"><em>17</em></a>)</span>. (D) Neuron firing rates in response to optical stimulation with 5-ms pulse frequencies ranging from 1 to 200 Hz. The left column re-plots data from <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref"><em>15</em></a>)</span>. The middle column shows results for an LIF neuron with a simple opsin, and the right column for a tonic AdEx neuron <span class="citation" data-cites="gerstner14">(<a href="references.html#ref-gerstner14" role="doc-biblioref"><em>18</em></a>)</span> with a Markov opsin model. The top row shows results for different light intensities: 100%, 120%, and 140% of the threshold for producing a single spike with a 5-ms pulse. The bottom row shows results for different expression levels relative to the default, <span class="math inline">\(\rho_{\text{rel}}\)</span>. The irradiance used for these simulations was 120% of the single-spike threshold.</figcaption><p></p>
</figure>
</div>
</section>
<section id="sec-cleo-experiments" class="level3">
<h3 class="anchored" data-anchor-id="sec-cleo-experiments">Example experiments</h3>
<p>In order to demonstrate Cleo’s utility to the public, we implemented three example experiments to feature in the upcoming publication:</p>
<ol type="1">
<li>Closed-loop inhibition of a traveling wave in a rodent somatosensory cortex model <span class="citation" data-cites="moldakarimov18">(<a href="references.html#ref-moldakarimov18" role="doc-biblioref"><em>19</em></a>)</span>. This experiment features a simple on/off control scheme where light activating an inhibitory opsin is turned on whenever the number of spikes detected at the optrode exceeds a threshold. The result is that while a wave of activity spreads outward through sensory cortex in response to a stimulus, the area around the optrode remains unperturbed. An experiment of this sort could explore the consequences of traveling waves in sensory cortex on perception.</li>
<li>Feedback control of layer 2/3 interneurons, disrupting plasticity in a model of primary visual cortex <span class="citation" data-cites="wilmes19">(<a href="references.html#ref-wilmes19" role="doc-biblioref"><em>20</em></a>)</span>. In this model, a top-down reward signal to vasoactive intestinal peptide (VIP) interneurons inhibits a population of parvalbumin (PV) interneurons, in turn disinhibiting a population of pyramidal cells (PC). However, using a proportional-integral (PI) feedback controller, we clamp the firing rate of interneurons, blocking this disinhibtion. Without increased PC firing, synaptic weights corresponding to the rewarded stimulus no longer increase, thus demonstrating how feedback control can disrupt normal circuit function.</li>
<li>Optogenetic evocation of sharp wave-ripples in an anatomically detailed model of hippocampus <span class="citation" data-cites="aussel18 aussel22">(<a href="references.html#ref-aussel18" role="doc-biblioref"><em>21</em></a>, <a href="references.html#ref-aussel22" role="doc-biblioref"><em>22</em></a>)</span>. This uses linear quadratic regulator control to evoke a reference sharp wave-ripple LFP signature. See <a href="#fig-hpc">Figure&nbsp;<span>4.4</span></a> for details, and note that feedback control, not looking ahead, so to speak, fails to evoke the reference signal at the desired time. The strategy I propose in Aim 2 should remedy this.</li>
</ol>
<div id="fig-hpc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/fig-case-study-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="img/fig-case-study-3.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.4: An example application of Cleo to the anatomical hippocampus model from Aussel et al. <span class="citation" data-cites="aussel18 aussel22">(<a href="references.html#ref-aussel18" role="doc-biblioref"><em>21</em></a>, <a href="references.html#ref-aussel22" role="doc-biblioref"><em>22</em></a>)</span>. (A) A 2.5 mm-thick slice of the 15 mm-tall model is shown. The model consists of four regions, entorhinal cortex (EC), dentate gyrus (DG), CA3, and CA1. Electrode contacts are represented as black dots and are in the same location as in the original model. Two light sources are shown in EC. Nine other such pairs (for a total of 20 light sources) not pictured here were spaced regularly parallel to the z axis. (B) Results are shown for ten trials each of three stimulation paradigms: naïve open-loop, where the input is simply a mirrored, rectified version of the reference signal; model-based open-loop, where a controller is run offline on a simulated model; and feedback control, where a controller is run using online measurements. Input <span class="math inline">\(\text{Irr}_0\)</span> is the light intensity at the tip of each optic fiber. The system output TKLFP refers to the Teleńczuk kernel LFP approximation.</figcaption><p></p>
</figure>
</div>
<!-- ### Open-source code and documentation -->
<p>Additionally, we have endeavored to make Cleo accessible to the public to aid in the exploration and adoption of CLOC methods. Cleo is open-source and can be installed from the Python Package Index under the name <code>cleosim</code>. The code can be found on <a href="https://github.com/Sensory-Information-Processing-Lab/Cleo">GitHub</a>. Documentation, including an overview, tutorials, and API reference, can be found at <a href="https://cleosim.readthedocs.io" class="uri">https://cleosim.readthedocs.io</a>.</p>
</section>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<!-- ### Guiding principles -->
<p>Because we (and Brian) prioritize point neuron models, Cleo does not currently support advanced, morphology-dependent features of neural dynamics as well as recording and stimulation. This would preclude realistically simulating extracellular potentials as well as the effects of spike sorting, for example. <!-- Currently, the sorted spikes signal Cleo can record assumes perfect sorting but could be made more realistic by adding sorting noise. --> However, if features such as these are needed, Cleo could be developed further to integrate with Brian’s morphological neuron features. And in the case of LFP, at least one other method exists for point-neuron LFP approximation which could be implemented to help compensate for the limitations of TKLFP <span class="citation" data-cites="mazzoni15a">(<a href="references.html#ref-mazzoni15a" role="doc-biblioref"><em>23</em></a>)</span>.</p>
<p>Both a strength and a limitation of Cleo’s design is that it depends on whatever model the user provides. This avoids the pitfall of painstakingly developing stock models that may or may not prove useful to researchers and instead lets them identify or develop a model that adequately describes the phenomena being studied. If a sufficiently realistic model for the studied system does not exist, however, developing one may be prohibitively costly, becoming a computational project in its own right as opposed to simply a stepping-stone towards an experiment. In these cases we suggest that a workaround could be to test a variety of potential models to identify which experimental configurations would be robust to unknown properties of the system. Indeed, the desired experiment in this case could be one that best adjudicates between these hypotheses.</p>
<!-- Regarding optogenetics, currently only channelrhodopsin-2 model parameters are included---comparing the effectiveness of different opsins will require first obtaining parameters.
This is important since improved opsins [@gunaydin10; @lin13; @klapoetke14; @hochbaum14; @mager18; @sridharan22; @kishi22], chloride pumps [@gradinaru10; @chuong14; @berndt16], channels [@govorunova15; @govorunova17], and  other innovations [@berndt16; @vierock21] have been engineered.
Thankfully, parameters for many opsins are available in published literature [@saran18; @gupta19a; @bansal20; @bansal20b; @bansal21a].
Another limitation is support for multiple simultaneous opsins or light sources.
At present, the user could manually include separate current terms for each opsin which is slow and cumbersome, but I plan on remedying this shortly to better support multi-channel optogenetics for Aims 2 and 3. -->
</section>
<section id="summary-of-contributions" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-contributions">Summary of contributions</h2>
<p>Cleo thus provides a simulation environment facilitating and accelerating the adoption and development of CLOC methods. Multiple features were designed to reflect this need, for example, neural simulation and experimental configuration at an intermediate level of realism, relevant recording and stimulation modalities, modular software architecture, flexible interfacing that can be easily adapted to existing Brian models, and arbitrary closed-loop processing enabling realistic processing delays. Moreover, we have developed virtual experiments to serve as examples as well as thorough online documentation so Cleo can help experimental labs test and potentially adopt CLOC methods.</p>


<div id="refs" class="references csl-bib-body" role="doc-bibliography" style="display: none">
<div id="ref-stimberg19" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">M. Stimberg, R. Brette, D. F. M. Goodman, Brian 2, an intuitive and efficient neural simulator. <em>eLife</em>. <strong>8</strong> (2019), doi:<a href="https://doi.org/10.7554/eLife.47314">10.7554/eLife.47314</a>.</div>
</div>
<div id="ref-bogdanchikov13" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">A. Bogdanchikov, M. Zhaparov, R. Suliyev, "<a href="https://doi.org/10.1088/1742-6596/423/1/012027">Python to learn programming</a>" in <em>Journal of <span>Physics</span>: <span>Conference Series</span></em> (<span>IOP Publishing</span>, 2013), vol. 423, p. 012027.</div>
</div>
<div id="ref-davison09" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">A. P. Davison, M. L. Hines, E. Muller, <a href="https://doi.org/10.3389/neuro.01.036.2009">Trends in programming languages for neuroscience simulations</a>. <em>Frontiers in Neuroscience</em>. <strong>3</strong>, 374–380 (2009).</div>
</div>
<div id="ref-muller15" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">E. Muller, J. A. Bednar, M. Diesmann, M. O. Gewaltig, M. Hines, A. P. Davison, <a href="https://doi.org/10.3389/fninf.2015.00011">Python in neuroscience</a>. <em>Frontiers in Neuroinformatics</em>. <strong>9</strong>, 11 (2015).</div>
</div>
<div id="ref-pettersen12" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">K. H. Pettersen, H. Lindén, A. M. Dale, G. T. Einevoll, Extracellular spikes and <span>CSD</span>. <em>Handbook of neural activity measurement</em>. <strong>1</strong>, 92–135 (2012).</div>
</div>
<div id="ref-buzsaki12" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">G. Buzsáki, C. A. Anastassiou, C. Koch, <a href="https://doi.org/10.1038/nrn3241">The origin of extracellular fields and currents <span>EEG</span>, <span>ECoG</span>, <span>LFP</span> and spikes</a>. <em>Nature Reviews Neuroscience 2012 13:6</em>. <strong>13</strong>, 407–420 (2012).</div>
</div>
<div id="ref-hagen18" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">E. Hagen, S. Næss, T. V. Ness, G. T. Einevoll, <a href="https://doi.org/10.3389/fninf.2018.00092">Multimodal modeling of neural network activity: <span>Computing LFP</span>, <span>ECoG</span>, <span>EEG</span>, and <span>MEG</span> signals with <span>LFPy</span> 2.0</a>. <em>Frontiers in Neuroinformatics</em>. <strong>12</strong>, 92 (2018).</div>
</div>
<div id="ref-parasuram16" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">H. Parasuram, B. Nair, E. D’Angelo, M. Hines, G. Naldi, S. Diwakar, <a href="https://doi.org/10.3389/fncom.2016.00065">Computational modeling of single neuron extracellular electric potentials and network local field potentials using <span>LFPsim</span></a>. <em>Frontiers in Computational Neuroscience</em>. <strong>10</strong>, 65 (2016).</div>
</div>
<div id="ref-tomsett15" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">R. J. Tomsett, M. Ainsworth, A. Thiele, M. Sanayei, X. Chen, M. A. Gieselmann, M. A. Whittington, M. O. Cunningham, M. Kaiser, <a href="https://doi.org/10.1007/s00429-014-0793-x">Virtual <span>Electrode Recording Tool</span> for <span>EXtracellular</span> potentials (<span>VERTEX</span>): Comparing multi-electrode recordings from simulated and biological mammalian cortical tissue</a>. <em>Brain Structure and Function</em>. <strong>220</strong>, 2333–2353 (2015).</div>
</div>
<div id="ref-thornton19" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">C. Thornton, F. Hutchings, M. Kaiser, The virtual electrode recording tool for extracellular potentials (<span>VERTEX</span>) <span>Version</span> 2.0: <span>Modelling</span> in vitro electrical stimulation of brain tissue. <em>Wellcome Open Research</em>. <strong>4</strong> (2019), doi:<a href="https://doi.org/10.12688/wellcomeopenres.15058.1">10.12688/wellcomeopenres.15058.1</a>.</div>
</div>
<div id="ref-nason20" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">11. </div><div class="csl-right-inline">S. R. Nason, A. K. Vaskov, M. S. Willsey, E. J. Welle, H. An, P. P. Vu, A. J. Bullard, C. S. Nu, J. C. Kao, K. V. Shenoy, T. Jang, H.-S. Kim, D. Blaauw, P. G. Patil, C. A. Chestek, <a href="https://doi.org/10.1038/s41551-020-0591-0">A low-power band of neuronal spiking activity dominated by local single units improves the performance of brainmachine interfaces</a>. <em>Nature Biomedical Engineering 2020</em>, 1–11 (2020).</div>
</div>
<div id="ref-holt99" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">12. </div><div class="csl-right-inline">G. R. Holt, C. Koch, <a href="https://doi.org/10.1023/A:1008832702585">Electrical interactions via the extracellular potential near cell bodies</a>. <em>Journal of Computational Neuroscience</em>. <strong>6</strong>, 169–184 (1999).</div>
</div>
<div id="ref-telenczuk20" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">13. </div><div class="csl-right-inline">B. Telenczuk, M. Telenczuk, A. Destexhe, <a href="https://doi.org/10.1016/j.jneumeth.2020.108871">A kernel-based method to calculate local field potentials from networks of spiking neurons</a>. <em>Journal of Neuroscience Methods</em>. <strong>344</strong>, 108871 (2020).</div>
</div>
<div id="ref-johnsen22" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">14. </div><div class="csl-right-inline">K. Johnsen, Kjohnsen/tklfp: V0.2.0 (2022), doi:<a href="https://doi.org/10.5281/zenodo.6787979">10.5281/zenodo.6787979</a>.</div>
</div>
<div id="ref-foutz12" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">15. </div><div class="csl-right-inline">T. J. Foutz, R. L. Arlow, C. C. Mcintyre, <a href="https://doi.org/10.1152/jn.00501.2011.-Optogenetics">Theoretical principles underlying optical stimulation of a channelrhodopsin-2 positive pyramidal neuron</a>. <em>J Neurophysiol</em>. <strong>107</strong>, 3235–3245 (2012).</div>
</div>
<div id="ref-vo-dinh03" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">16. </div><div class="csl-right-inline">T. Vo-Dinh, <em><a href="https://doi.org/10.1001/archfaci.3.3.207">Biomedical <span>Photonics</span>: <span>Handbook</span></a></em> (<span>CRC Press</span>, 2003).</div>
</div>
<div id="ref-evans16" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">17. </div><div class="csl-right-inline">B. D. Evans, S. Jarvis, S. R. Schultz, K. Nikolic, <a href="https://doi.org/10.3389/fninf.2016.00008"><span>PyRhO</span>: <span>A Multiscale Optogenetics Simulation Platform</span></a>. <em>Frontiers in Neuroinformatics</em>. <strong>10</strong>, 8 (2016).</div>
</div>
<div id="ref-gerstner14" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">18. </div><div class="csl-right-inline">W. Gerstner, W. M. Kistler, R. Naud, L. Paninski, <em><a href="https://doi.org/10.1017/CBO9781107447615">Neuronal dynamics: <span>From</span> single neurons to networks and models of cognition</a></em> (<span>Cambridge University Press</span>, 2014).</div>
</div>
<div id="ref-moldakarimov18" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">19. </div><div class="csl-right-inline">S. Moldakarimov, M. Bazhenov, D. E. Feldman, T. J. Sejnowski, <a href="https://doi.org/10.1073/pnas.1710202115">Structured networks support sparse traveling waves in rodent somatosensory cortex</a>. <em>Proceedings of the National Academy of Sciences of the United States of America</em>. <strong>115</strong>, 5277–5282 (2018).</div>
</div>
<div id="ref-wilmes19" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">20. </div><div class="csl-right-inline">K. A. Wilmes, C. Clopath, <a href="https://doi.org/10.1038/s41467-019-12972-2">Inhibitory microcircuits for top-down plasticity of sensory representations</a>. <em>Nature Communications</em>. <strong>10</strong>, 5055 (2019).</div>
</div>
<div id="ref-aussel18" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">21. </div><div class="csl-right-inline">A. Aussel, L. Buhry, L. Tyvaert, R. Ranta, <a href="https://doi.org/10.1007/s10827-018-0704-x">A detailed anatomical and mathematical model of the hippocampal formation for the generation of sharp-wave ripples and theta-nested gamma oscillations</a>. <em>Journal of Computational Neuroscience</em>. <strong>45</strong>, 207–221 (2018).</div>
</div>
<div id="ref-aussel22" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">22. </div><div class="csl-right-inline">A. Aussel, R. Ranta, O. Aron, S. Colnat-Coulbois, L. Maillard, L. Buhry, Cell to network computational model of the epileptic human hippocampus suggests specific roles of network and channel dysfunctions in the ictal and interictal oscillations. <em>Journal of Computational Neuroscience</em> (2022), doi:<a href="https://doi.org/10.1007/s10827-022-00829-5">10.1007/s10827-022-00829-5</a>.</div>
</div>
<div id="ref-mazzoni15a" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">23. </div><div class="csl-right-inline">A. Mazzoni, H. Lindén, H. Cuntz, A. Lansner, S. Panzeri, G. T. Einevoll, <a href="https://doi.org/10.1371/JOURNAL.PCBI.1004584">Computing the <span>Local Field Potential</span> (<span>LFP</span>) from <span class="nocase">Integrate-and-Fire Network Models</span></a>. <em>PLOS Computational Biology</em>. <strong>11</strong>, e1004584 (2015).</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../src/background.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Background</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../src/aim2.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Aim 2 - Multi-input CLOC</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","openEffect":"zoom","selector":".lightbox","loop":true,"closeEffect":"zoom"});</script>



</body></html>