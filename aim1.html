<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Developing and exploiting optogenetic feedback control in mesoscale neuroscience - 4&nbsp; Aim 1: A CLOC simulation testbed</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./aim2.html" rel="next">
<link href="./background.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Aim 1: A CLOC simulation testbed</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Developing and exploiting optogenetic feedback control in mesoscale neuroscience</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/kjohnsen/phd-proposal/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="./Developing-and-exploiting-optogenetic-feedback-control-in-mesoscale-neuroscience.pdf" title="Download PDF" class="sidebar-tool px-1"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./specific-aims.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Specific Aims</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./background.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Background</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aim1.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Aim 1: A CLOC simulation testbed</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aim2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Aim 2: Multi-input CLOC</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aim3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Aim 3: Control of latent population dynamics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./timeline.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Proposed timeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#rationale" id="toc-rationale" class="nav-link active" data-scroll-target="#rationale">Rationale</a>
  <ul>
  <li><a href="#innovation" id="toc-innovation" class="nav-link" data-scroll-target="#innovation">Innovation</a></li>
  </ul></li>
  <li><a href="#approach" id="toc-approach" class="nav-link" data-scroll-target="#approach">Approach</a>
  <ul>
  <li><a href="#guiding-principles" id="toc-guiding-principles" class="nav-link" data-scroll-target="#guiding-principles">Guiding principles</a></li>
  <li><a href="#sec-cleo-arch" id="toc-sec-cleo-arch" class="nav-link" data-scroll-target="#sec-cleo-arch">Closed-loop simulation architecture</a></li>
  <li><a href="#sec-elec" id="toc-sec-elec" class="nav-link" data-scroll-target="#sec-elec">Electrode recording</a>
  <ul class="collapse">
  <li><a href="#spiking" id="toc-spiking" class="nav-link" data-scroll-target="#spiking">Spiking</a></li>
  <li><a href="#lfp" id="toc-lfp" class="nav-link" data-scroll-target="#lfp">LFP</a></li>
  </ul></li>
  <li><a href="#optogenetic-stimulation" id="toc-optogenetic-stimulation" class="nav-link" data-scroll-target="#optogenetic-stimulation">Optogenetic stimulation</a>
  <ul class="collapse">
  <li><a href="#light-model" id="toc-light-model" class="nav-link" data-scroll-target="#light-model">Light model</a></li>
  <li><a href="#opsin-models" id="toc-opsin-models" class="nav-link" data-scroll-target="#opsin-models">Opsin models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul>
  <li><a href="#model-validation" id="toc-model-validation" class="nav-link" data-scroll-target="#model-validation">Model validation</a></li>
  <li><a href="#sec-cleo-experiments" id="toc-sec-cleo-experiments" class="nav-link" data-scroll-target="#sec-cleo-experiments">Example experiments</a></li>
  <li><a href="#open-source-code-and-documentation" id="toc-open-source-code-and-documentation" class="nav-link" data-scroll-target="#open-source-code-and-documentation">Open-source code and documentation</a></li>
  </ul></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a>
  <ul>
  <li><a href="#guiding-principles-1" id="toc-guiding-principles-1" class="nav-link" data-scroll-target="#guiding-principles-1">Guiding principles</a></li>
  <li><a href="#closed-loop-simulation-architecture" id="toc-closed-loop-simulation-architecture" class="nav-link" data-scroll-target="#closed-loop-simulation-architecture">Closed-loop simulation architecture</a></li>
  <li><a href="#electrodes" id="toc-electrodes" class="nav-link" data-scroll-target="#electrodes">Electrodes</a></li>
  <li><a href="#optogenetics" id="toc-optogenetics" class="nav-link" data-scroll-target="#optogenetics">Optogenetics</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-aim1" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Aim 1: A CLOC simulation testbed</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="rationale" class="level2">
<h2 class="anchored" data-anchor-id="rationale">Rationale</h2>
<p>CLOC experiments are difficult and costly. This can be a barrier to entry for neuroscientists that find CLOC’s advantages attractive. Their lab might lack the funds to invest in necessary hardware or the time to invest in adding high-performance signal processing loop to their experimental workflow. Or, they may possess the resources but do not want to spend them without some assurance that their proposed experiment would be fruitful. Finally, when the proposed experiment requires signal processing/control method development, iterating on designs <em>in-vivo</em> may be cumbersome, given the additional cost of animal care and training.</p>
<p>Taken together, these factors not only make CLOC experiments a significant investment for a researcher, but one laden with risk. Unknown properties of the system under study can make it hard to predict whether a proposed experiment (e.g., whether a given population of neurons can be controlled in a given way) is likely to succeed, and even more so when working with innovative methods with little precedent in the literature.</p>
<p>However, these costs and risks can be mitigated through in silico prototyping. Given a reliable model of the system of interest, one can simulate a proposed experiment, assessing the effectiveness of a given setup. Alternate models can be tested to assess robustness of the given method to unknown model properties, or a single method can be validated on a variety of models to determine its general applicability. This strategy not only allows for a researcher to evaluate and optimize methods before committing significant resources to them, but also accelerates the development cycle.</p>
<section id="innovation" class="level3">
<h3 class="anchored" data-anchor-id="innovation">Innovation</h3>
<p>For these reasons, I have developed Cleo: Closed Loop, Electrophysiology, and Optogenetics experiment simulation testbed. Unlike existing software, Cleo simultaneously provides a high-level interface to fast and flexible neural network simulations; easy, model-independent injection of electrode recording and optogenetic perturbations; and a real-time, closed-loop processing module capable of modeling communication and processing delays inherent in real experiments. I thus provide a “free trial” to researchers who are unsure if CLOC will serve their research agenda, as well as a low-cost environment to design experiments and develop methods, for those who are already committed to the technqiue.</p>
</section>
</section>
<section id="approach" class="level2">
<h2 class="anchored" data-anchor-id="approach">Approach</h2>
<section id="guiding-principles" class="level3">
<h3 class="anchored" data-anchor-id="guiding-principles">Guiding principles</h3>
<p>Two factors drove our choice of recording and stimulation models to integrate into Cleo. First, because a main purpose of Cleo is to enable prototyping of experiments, we focused on models at the level of the parameters an experimenter is able to alter. Because parameters such as electrode location, channel count and density, and optic fiber depth and size are all defined naturally in spatially extended models, Cleo’s electrode and optogenetics modules require a “spatial” network model where relevant neurons must be assigned coordinates in space.</p>
<p>Second, we assumed that highly realistic models of individual neurons are not needed to capture most mesoscale-level phenomena. Accordingly, Cleo was developed with the intention of using point neurons models, rather than multi-compartment neuron models with realistic morphologies. Simulating simpler neuron models offers advantages of speed and intuitiveness, which are important in the context of prototyping an experiment. This decision had consequences in our software (<a href="#sec-cleo-arch"><span>Section&nbsp;4.2.2</span></a>) and LFP modeling (<a href="#sec-elec"><span>Section&nbsp;4.2.3</span></a>) decisions.</p>
<p>In addition to our modeling priorities, the goals of usability, flexibility, and extensibility guided our choices in software dependencies and infrastructure. Ease of use is important to make Cleo as accessible as possible, especially to researchers with primarily experimental backgrounds who may not have extensive experience with computational modeling. This usability goal also motivated Cleo’s modular design, which allows users to add different recording or stimulation devices with little or no modification to the underlying network model, easing the burden of testing a variety of experimental configurations. Flexibility in the underlying simulator, in addition to enabling compatibility with a wide variety of models, is necessary for arbitrarily interacting with the simulation in a closed-loop fashion. Finally, extensibility is important for the testbed to remain relevant under changing needs in the future, allowing for new functionality to be easily added in a “plug-in,” modular architecture.</p>
</section>
<section id="sec-cleo-arch" class="level3">
<h3 class="anchored" data-anchor-id="sec-cleo-arch">Closed-loop simulation architecture</h3>
<div id="fig-cleo-arch" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><a href="img/cleo-arch.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="A conceptual diagram of Cleo’s functionality. Cleo wraps a Brian network model, injects stimulation and recording devices, and interfaces with the network in real time through a simulated “I/O processor”."><img src="img/cleo-arch.png" class="img-fluid figure-img"></a></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: A conceptual diagram of Cleo’s functionality. Cleo wraps a Brian network model, injects stimulation and recording devices, and interfaces with the network in real time through a simulated “I/O processor”.</figcaption><p></p>
</figure>
</div>
<p>We chose Brian 2 <span class="citation" data-cites="stimberg19">(<a href="references.html#ref-stimberg19" role="doc-biblioref">Stimberg et al., 2019</a>)</span> as the spiking neural network simulator to build Cleo around. Brian is a relatively new spiking neural network simulator written in Python with multiple advantages. It flexibly allows (and even requires) the user to define models mathematically rather than selecting from a pre-defined library of cell types and features, while maintaining the ease of a high-level interface. This keeps model and experiment details together and enables us to define arbitrary recording and stimulation models that easily interface with the simulation. Moreover, the Python programming language has the advantages of being open-source, intuitive to learn <span class="citation" data-cites="bogdanchikov13">(<a href="references.html#ref-bogdanchikov13" role="doc-biblioref">Bogdanchikov et al., 2013</a>)</span>, and widely used in computational neuroscience <span class="citation" data-cites="davison09 muller15">(<a href="references.html#ref-davison09" role="doc-biblioref">Davison et al., 2009</a>; <a href="references.html#ref-muller15" role="doc-biblioref">Muller et al., 2015</a>)</span>. Users do not need to use any other languages to use Brian. Brian is also relatively fast (especially since it is developed primarily for point neuron simulations), as shown in benchmarks <span class="citation" data-cites="stimberg19">(<a href="references.html#ref-stimberg19" role="doc-biblioref">Stimberg et al., 2019</a>)</span>.</p>
<p>Cleo provides three modules—recording, stimulation, and closed-loop processing—for integration with an existing Brian model (see <a href="#fig-cleo-arch">Figure&nbsp;<span>4.1</span></a>). Cleo’s functionality centers around a <code>CLSimulator</code> object that orchestrates the interactions between these three modules and the Brian simulation by injecting devices, running the simulation, and communicating with an <code>IOProcessor</code> object at each time step. The <code>IOProcessor</code> receives recorder measurements according to a specified sampling rate and returns any updates to stimulator devices.</p>
<p>In order to simulate the effects of latency in closed-loop control, Cleo provides a <code>LatencyIOProcessor</code> class capable of delivering control signals after some delay. It does this by storing the outputs calculated for every sample in a buffer along with the time they can be delivered to the network. For example, if a sample is taken at 20 ms and the user wishes to simulate a processing and communication latency of 3 ms, the control signal, along with the output time of 23 ms is stored in a buffer which the simulation checks at every timestep. As soon as the simulation clock reaches 23 ms, the control signal is taken from the buffer and applied to the stimulator devices. Because the user has arbitrary control over this latency, they can easily simulate probabilistic delays if, for example, they wish to assess the effect of the experimental platform stalling occasionally.</p>
<p>By default, <code>LatencyIOProcessor</code> samples on a fixed schedule and simulates processing samples in parallel—that is, the computation time for one sample does not affect that of others. Some alternatives are available, as illustrated in <a href="#fig-latency">Figure&nbsp;<span>4.2</span></a>.</p>
<div id="fig-latency" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/fig-latency.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="img/fig-latency.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: Latency emulation strategy and available configurations. (A) Cleo registers the time a sample is taken from the recording devices, the times the computation starts and ends, applying the user-specified delay, and updates stimulation devices when finished. (B) The default, parallel processing/fixed sampling mode. (C) The serial processing/fixed sampling case reflects when computations are not performed in parallel, but sampling continues on a fixed schedule. (D) The final processing mode avoids buffer overflow by sampling only once the computation for the previous step has terminated.</figcaption><p></p>
</figure>
</div>
</section>
<section id="sec-elec" class="level3">
<h3 class="anchored" data-anchor-id="sec-elec">Electrode recording</h3>
<section id="spiking" class="level4">
<h4 class="anchored" data-anchor-id="spiking">Spiking</h4>
<p>Because we have prioritized point neuron simulations, the electrode functionality currently implemented in Cleo does not rely on raw extracellular potentials, which can only be computed from multi-compartment neurons <span class="citation" data-cites="pettersen12 buzsaki12">(<a href="references.html#ref-buzsaki12" role="doc-biblioref">Buzsáki et al., 2012</a>; <a href="references.html#ref-pettersen12" role="doc-biblioref">Pettersen et al., 2012</a>)</span>. This biophysical forward modeling approach has been taken in other software <span class="citation" data-cites="hagen18 parasuram16 tomsett15 thornton19">(<a href="references.html#ref-hagen18" role="doc-biblioref">Hagen et al., 2018</a>; <a href="references.html#ref-parasuram16" role="doc-biblioref">Parasuram et al., 2016</a>; <a href="references.html#ref-thornton19" role="doc-biblioref">Thornton et al., 2019</a>; <a href="references.html#ref-tomsett15" role="doc-biblioref">Tomsett et al., 2015</a>)</span>.</p>
<p>To approximate spike recording without filtering and thresholding of extracellular potentials, Cleo simply takes ground-truth spikes and stochastically determines which to report using a detection probability function. This function is parametrized by a perfect detection radius, within which all spikes are reported, a half detection radius, at which distance there is a 50% chance a spike will be detected, and a cutoff probability, below which all neurons are ignored. The detection probability function is interpolated between the parametrized points with a <span class="math inline">\(1/r\)</span> function <span class="citation" data-cites="nason20 holt99">(<a href="references.html#ref-holt99" role="doc-biblioref">Holt and Koch, 1999</a>; <a href="references.html#ref-nason20" role="doc-biblioref">Nason et al., 2020</a>)</span>, where <span class="math inline">\(r\)</span> is the distance between the neuron and the electrode (see <a href="#fig-elec">Figure&nbsp;<span>4.3</span></a>).</p>
<p>Cleo provides spike recording functionality in two forms: multi-unit and sorted. Multi-unit spiking reports every spike detected by every channel, without regard for the origin of the spike. Thus, each channel can report spikes from multiple neurons and a single spike can be reported on multiple channels. Sorted spiking reports all spikes detected on at least one channel, where each neuron is identified by a unique index. While real-time spike sorting is currently not feasible in practice for large numbers of contacts, this sorted spiking option could be used to emulate a common workflow of isolating one or a few neurons to report spikes from in real time.</p>
<div id="fig-elec" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/fig-electrodes.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="img/fig-electrodes.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.3: Illustration of LFP and spiking from Cleo’s electrophysiology module. (A) The probabilistic spike detection model. All spikes within the 100% detection radius, 50% of spikes at the 50% detection radius, and none of those outside the threshold radius are recorded. The detection probability decays with 1/r. (B) An example plot generated by Cleo showing the positions of neurons and electrode contacts. (C) Randomly generated spikes for the neurons shown in B. Top: the sorted spike signal, which gives the ground truth source neuron for every spike as a perfect proxy for spike sorting. Bottom: multi-unit spikes, where spikes are reported on every channel they are detected on, regardless of the source neuron. (D) The TKLFP signal generated from the spikes in C for each channel. Y-axis units are not shown.</figcaption><p></p>
</figure>
</div>
</section>
<section id="lfp" class="level4">
<h4 class="anchored" data-anchor-id="lfp">LFP</h4>
<p>In order to approximate cortical LFP without recurring to morphological neurons and biophysical forward modeling, we implemented the kernel LFP approximation from <span class="citation" data-cites="telenczuk20">(<a href="references.html#ref-telenczuk20" role="doc-biblioref">Telenczuk et al., 2020</a>)</span>, which we term TKLFP (Teleńczuk kernel LFP). This method approximates the per-spike contribution to LFP (termed uLFP: unitary LFP) with a delayed Gaussian function, where amplitude and delay depend on the position of the neuron relative to the electrode. While the original study included reference peak amplitude <span class="math inline">\(A_0\)</span> values at just four cortical depths, we inferred these values for arbitrary depths by performing cubic interpolation on data from their figure 5 and assumed that this profile dropped to zero at 600 µm below the soma and 1000 µm above. This implementation is available as a standalone Python package on PyPI <span class="citation" data-cites="johnsen22">(<a href="references.html#ref-johnsen22" role="doc-biblioref">Johnsen, 2022</a>)</span>. Accuracy of this implementation is verified in automated test suites in both TKLFP and Cleo packages.</p>
</section>
</section>
<section id="optogenetic-stimulation" class="level3">
<h3 class="anchored" data-anchor-id="optogenetic-stimulation">Optogenetic stimulation</h3>
<section id="light-model" class="level4">
<h4 class="anchored" data-anchor-id="light-model">Light model</h4>
<p>Cleo simulates optogenetic stimulation by combining a model of light propagation with an opsin model relating light to current. The light model is taken from <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref">Foutz et al., 2012</a>)</span> and uses Kubelka-Munk light propagation. This is a simplified model operating on the assumption that the medium is optically homogeneous, which, while not true, was shown by Foutz et al. to be a suitable approximation. Cleo includes absorbance, scattering, and refraction parameters for blue, 473-nm light as given in <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref">Foutz et al., 2012</a>)</span>.</p>
</section>
<section id="opsin-models" class="level4">
<h4 class="anchored" data-anchor-id="opsin-models">Opsin models</h4>
<p>Independent of the light propagation model, Cleo provides two different opsin models. One is a four-state Markov model as presented in <span class="citation" data-cites="evans16">(<a href="references.html#ref-evans16" role="doc-biblioref">Evans et al., 2016</a>)</span>, which captures rise, peak, plateau, and fall dynamics as the opsin is activated and deactivated through a Markov process. Additionally, by defining conductance rather than current directly, the model is able to reproduce the photocurrent’s dependence on the membrane potential (see <a href="#fig-opto">Figure&nbsp;<span>4.4</span></a>). While the four-state model fits experimental data fairly well, the code is structured so that the three- or six-state models in <span class="citation" data-cites="evans16">(<a href="references.html#ref-evans16" role="doc-biblioref">Evans et al., 2016</a>)</span> could also be easily implemented.</p>
<p>Because the Markov model depends on somewhat realistic membrane potential and resistance values, however, it is not well suited for many pre-existing models that do not. For example, many commonly used leaky integrate-and-fire (LIF) neurons define the membrane potential as ranging from 0 to 1, rather than -70 mV to -50 mV, rendering both the units and values (relative to the opsin’s reversal potential) incompatible. One solution would be for users to adapt their neuron models for compatibility with this Markov opsin model, but since this would be burdensome, we developed an alternative model that simply delivers photocurrent proportional to the light intensity at each neuron. Thus, users can retain their original model with no need to add units or modify parameters.</p>
<p>In addition to options for opsin modeling, Cleo allows the user to specify both the probability that cells of a target population express an opsin and the per-cell expression level. This allows for the study of the impact of heterogeneous expression on the outcome of an experiment.</p>
</section>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="model-validation" class="level3">
<h3 class="anchored" data-anchor-id="model-validation">Model validation</h3>
<p>The light model from <span class="citation" data-cites="foutz12">(<a href="references.html#ref-foutz12" role="doc-biblioref">Foutz et al., 2012</a>)</span> was successfully replicated, and the light intensity-firing rate relationship was qualitatively similar to that originally reported, though differing in some respects. This can be attributed to the use of point neurons rather than morphological neurons. See <a href="#fig-opto">Figure&nbsp;<span>4.4</span></a> for details. Additionally, preliminary experiments show that the simplified, proportional current opsin model is able to produce a firing response qualitatively similar to that of the Markov model.</p>
<div id="fig-opto" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/fig-opto.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="img/fig-opto.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.4: Validation of the optogenetics module. (A) Light transmittance <span class="math inline">\(T\)</span> as a function of radius and axial distance from the optic fiber tip. Transmittance refers to the irradiance <span class="math inline">\(\text{Irr}\)</span> as a proportion of the irradiance at the fiber tip <span class="math inline">\(\text{Irr}_0\)</span>. After Figure 2a from <span class="citation" data-cites="foutz12">Foutz et al. (<a href="references.html#ref-foutz12" role="doc-biblioref">2012</a>)</span>. (B) Light transmittance <span class="math inline">\(T\)</span> as a function of distance <span class="math inline">\(z\)</span> straight out from the fiber tip for different optic fiber sizes. After Figure 2b from <span class="citation" data-cites="foutz12">Foutz et al. (<a href="references.html#ref-foutz12" role="doc-biblioref">2012</a>)</span>. (C) Photocurrent <span class="math inline">\(I_\text{opto}\)</span> for ramping light of different intensities. After the figure produced by the “ramp” protocol from the default PyRhO simulator <span class="citation" data-cites="evans16">Evans et al. (<a href="references.html#ref-evans16" role="doc-biblioref">2016</a>)</span>. (D) Neuron firing rates in response to optical stimulation with 5-ms pulse frequencies ranging from 1 to 200 Hz. The left column re-plots data from <span class="citation" data-cites="foutz12">Foutz et al. (<a href="references.html#ref-foutz12" role="doc-biblioref">2012</a>)</span>. The middle column shows results for an LIF neuron with a simple opsin, and the right column for a tonic AdEx neuron <span class="citation" data-cites="gerstner14">(<a href="references.html#ref-gerstner14" role="doc-biblioref">Gerstner et al., 2014</a>)</span> with a Markov opsin model. The top row shows results for different light intensities: 100%, 120%, and 140% of the threshold for producing a single spike with a 5-ms pulse. The bottom row shows results for different expression levels relative to the default, <span class="math inline">\(\rho_{\text{rel}}\)</span>. The irradiance used for these simulations was 120% of the single-spike threshold.</figcaption><p></p>
</figure>
</div>
</section>
<section id="sec-cleo-experiments" class="level3">
<h3 class="anchored" data-anchor-id="sec-cleo-experiments">Example experiments</h3>
<p>In order to demonstrate Cleo’s utility to the public, we implemented three example experiments to feature in the upcoming publication:</p>
<ol type="1">
<li>Closed-loop inhibition of a traveling wave in a rodent somatosensory cortex model <span class="citation" data-cites="moldakarimov18">(<a href="references.html#ref-moldakarimov18" role="doc-biblioref">Moldakarimov et al., 2018</a>)</span>.</li>
<li>Feedback control of layer 2/3 interneurons, disrupting plasticity in a model of primary visual cortex <span class="citation" data-cites="wilmes19">(<a href="references.html#ref-wilmes19" role="doc-biblioref">Wilmes and Clopath, 2019</a>)</span>.</li>
<li>Optogenetic evocation of sharp wave-ripples in an anatomically detailed model of hippocampus <span class="citation" data-cites="aussel18 aussel22">(<a href="references.html#ref-aussel22" role="doc-biblioref">Aussel et al., 2022</a>, <a href="references.html#ref-aussel18" role="doc-biblioref">2018</a>)</span>. See <a href="#fig-hpc">Figure&nbsp;<span>4.5</span></a> for details, and note that feedback control, not looking ahead, so to speak, fails to evoke the reference signal at the desired time. The strategy I propose in <a href="aim2.html"><span>Chapter&nbsp;5</span></a> should remedy this.</li>
</ol>
<div id="fig-hpc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/fig-case-study-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="img/fig-case-study-3.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.5: An example application of Cleo to the anatomical hippocampus model from Aussel et al. <span class="citation" data-cites="aussel18 aussel22">(<a href="references.html#ref-aussel22" role="doc-biblioref">2022</a>, <a href="references.html#ref-aussel18" role="doc-biblioref">2018</a>)</span>. (A) A 2.5 mm-thick slice of the 15 mm-tall model is shown. The model consists of four regions, entorhinal cortex (EC), dentate gyrus (DG), CA3, and CA1. Electrode contacts are represented as black dots and are in the same location as in the original model. Two light sources are shown in EC. Nine other such pairs (for a total of 20 light sources) not pictured here were spaced regularly parallel to the z axis. (B) Results are shown for ten trials each of three stimulation paradigms: naïve open-loop, where the input is simply a mirrored, rectified version of the reference signal; model-based open-loop, where a controller is run offline on a simulated model; and feedback control, where a controller is run using online measurements. Input <span class="math inline">\(\text{Irr}_0\)</span> is the light intensity at the tip of each optic fiber. The system output TKLFP refers to the Teleńczuk kernel LFP approximation.</figcaption><p></p>
</figure>
</div>
</section>
<section id="open-source-code-and-documentation" class="level3">
<h3 class="anchored" data-anchor-id="open-source-code-and-documentation">Open-source code and documentation</h3>
<p>Cleo is open-source and can be installed from the Python Package Index under the name <code>cleosim</code>. The code can be found on <a href="https://github.com/Sensory-Information-Processing-Lab/Cleo">GitHub</a>. Documentation, including an overview, tutorials, and API reference, can be found at <a href="https://cleosim.readthedocs.io" class="uri">https://cleosim.readthedocs.io</a>.</p>
</section>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<section id="guiding-principles-1" class="level3">
<h3 class="anchored" data-anchor-id="guiding-principles-1">Guiding principles</h3>
<p>Because we prioritize point neuron models, Cleo does not currently provide tools for recording realistic extracellular potentials. This would preclude realistically simulating such methods as spike sorting. Currently, the sorted spikes signal Cleo can record assumes perfect sorting but could be made more realistic by adding sorting noise.</p>
</section>
<section id="closed-loop-simulation-architecture" class="level3">
<h3 class="anchored" data-anchor-id="closed-loop-simulation-architecture">Closed-loop simulation architecture</h3>
<p>One downside of using Brian is that it does not have the same first-class support for multi-compartment neurons as the popular NEURON <span class="citation" data-cites="hines97">(<a href="references.html#ref-hines97" role="doc-biblioref">Hines and Carnevale, 1997</a>)</span> simulator. Using point neurons precludes advanced, morphology-dependent features of neural dynamics as well as recording and stimulation. However, if this feature is needed, Cleo could be developed further to integrate with Brian’s morphological neuron features.</p>
<p>Both a strength and a limitation of Cleo’s design is that it depends on whatever model the user provides. This avoids the pitfall of painstakingly developing stock models may or may not prove useful to researchers and instead lets them identify or develop a model that adequately describes the phenomena being studied. If a sufficiently realistic model for the studied system does not exist, however, developing one may be prohibitively costly, becoming a computational project in its own right as opposed to simply a stepping-stone towards an experiment. In these cases we suggest that a workaround could be to test a variety of potential models to identify which experimental configurations would be robust to unknown properties of the system. Indeed, the desired experiment in this case could be one that best adjudicates between these hypotheses <span class="citation" data-cites="willats-clinc">(<a href="references.html#ref-willats-clinc" role="doc-biblioref"><strong>willats-clinc?</strong></a>)</span>.</p>
</section>
<section id="electrodes" class="level3">
<h3 class="anchored" data-anchor-id="electrodes">Electrodes</h3>
<p>Using point neurons requires approximation of extraceullar potentials, which do not perfectly match ground-truth signals. The TKLFP approximation Cleo uses, for example, underrepresents high-frequency signals. Fortunately, there is an alternate, potentially more accurate, LFP approximation for point neurons that can be added to Cleo in the future if needed <span class="citation" data-cites="mazzoni15a">(<a href="references.html#ref-mazzoni15a" role="doc-biblioref">Mazzoni et al., 2015</a>)</span> and which we are implementing now.</p>
</section>
<section id="optogenetics" class="level3">
<h3 class="anchored" data-anchor-id="optogenetics">Optogenetics</h3>
<p>Currently only channelrhodopsin-2 model parameters are included—comparing the effectiveness of different opsins will require first obtaining parameters. This is important since new opsins have been engineered with improved characteristics <span class="citation" data-cites="gunaydin10 lin13 klapoetke14 hochbaum14 mager18 sridharan22 kishi22">(<a href="references.html#ref-gunaydin10" role="doc-biblioref">Gunaydin et al., 2010</a>; <a href="references.html#ref-hochbaum14" role="doc-biblioref">Hochbaum et al., 2014</a>; <a href="references.html#ref-kishi22" role="doc-biblioref">Kishi et al., 2022</a>; <a href="references.html#ref-klapoetke14" role="doc-biblioref">Klapoetke et al., 2014</a>; <a href="references.html#ref-lin13" role="doc-biblioref">Lin et al., 2013</a>; <a href="references.html#ref-mager18" role="doc-biblioref">Mager et al., 2018</a>; <a href="references.html#ref-sridharan22" role="doc-biblioref">Sridharan et al., 2022</a>)</span>, as well as chloride pumps <span class="citation" data-cites="gradinaru10 chuong14 berndt16">(<a href="references.html#ref-berndt16" role="doc-biblioref">Berndt et al., 2016</a>; <a href="references.html#ref-chuong14" role="doc-biblioref">Chuong et al., 2014</a>; <a href="references.html#ref-gradinaru10" role="doc-biblioref">Gradinaru et al., 2010</a>)</span>, channels <span class="citation" data-cites="govorunova15 govorunova17">(<a href="references.html#ref-govorunova17" role="doc-biblioref">Govorunova et al., 2017</a>, <a href="references.html#ref-govorunova15" role="doc-biblioref">2015</a>)</span>, and other innovations <span class="citation" data-cites="berndt16 vierock21">(<a href="references.html#ref-berndt16" role="doc-biblioref">Berndt et al., 2016</a>; <a href="references.html#ref-vierock21" role="doc-biblioref">Vierock et al., 2021</a>)</span>]. Thankfully, parameters for many opsins are available in published literature <span class="citation" data-cites="saran18 gupta19a bansal20 bansal20b bansal21a">(<a href="references.html#ref-bansal21a" role="doc-biblioref">Bansal et al., 2021</a>, <a href="references.html#ref-bansal20" role="doc-biblioref">2020a</a>, <a href="references.html#ref-bansal20b" role="doc-biblioref">2020b</a>; <a href="references.html#ref-gupta19a" role="doc-biblioref">Gupta et al., 2019</a>; <a href="references.html#ref-saran18" role="doc-biblioref">Saran et al., 2018</a>)</span>.</p>
<p>Another limitation is support for multiple simultaneous opsins or light sources. At present, the user could manually include separate current terms for each opsin in neuron model equations or approximate spectral overlap by adding a fraction of a light source’s intensity to that of another, but this potentially slow workflow is antithetical to Cleo’s goal of requiring minimum work to test different scenarios. We plan on adding this functionality shortly, since it will be important for Aims 2 and 3.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-aussel18" class="csl-entry" role="doc-biblioentry">
Aussel A, Buhry L, Tyvaert L, Ranta R. 2018. A detailed anatomical and mathematical model of the hippocampal formation for the generation of sharp-wave ripples and theta-nested gamma oscillations. <em>J Comput Neurosci</em> <strong>45</strong>:207–221. doi:<a href="https://doi.org/10.1007/s10827-018-0704-x">10.1007/s10827-018-0704-x</a>
</div>
<div id="ref-aussel22" class="csl-entry" role="doc-biblioentry">
Aussel A, Ranta R, Aron O, Colnat-Coulbois S, Maillard L, Buhry L. 2022. Cell to network computational model of the epileptic human hippocampus suggests specific roles of network and channel dysfunctions in the ictal and interictal oscillations. <em>J Comput Neurosci</em>. doi:<a href="https://doi.org/10.1007/s10827-022-00829-5">10.1007/s10827-022-00829-5</a>
</div>
<div id="ref-bansal21a" class="csl-entry" role="doc-biblioentry">
Bansal H, Gupta N, Roy S. 2021. Theoretical analysis of optogenetic spiking with ChRmine, bReaChES and CsChrimson-expressing neurons for retinal prostheses. <em>Journal of Neural Engineering</em> <strong>18</strong>:0460b8. doi:<a href="https://doi.org/10.1088/1741-2552/ac1175">10.1088/1741-2552/ac1175</a>
</div>
<div id="ref-bansal20" class="csl-entry" role="doc-biblioentry">
Bansal H, Gupta N, Roy S. 2020a. Theoretical Analysis of Low-power Bidirectional Optogenetic Control of High-frequency Neural Codes with Single Spike Resolution. <em>Neuroscience</em> <strong>449</strong>:165–188. doi:<a href="https://doi.org/10.1016/j.neuroscience.2020.09.022">10.1016/j.neuroscience.2020.09.022</a>
</div>
<div id="ref-bansal20b" class="csl-entry" role="doc-biblioentry">
Bansal H, Gupta N, Roy S. 2020b. Comparison of low-power, high-frequency and temporally precise optogenetic inhibition of spiking in NpHR, eNpHR3.0 and Jaws-expressing neurons. <em>Biomedical Physics and Engineering Express</em> <strong>6</strong>:045011. doi:<a href="https://doi.org/10.1088/2057-1976/ab90a1">10.1088/2057-1976/ab90a1</a>
</div>
<div id="ref-berndt16" class="csl-entry" role="doc-biblioentry">
Berndt A, Lee SY, Wietek J, Ramakrishnan C, Steinberg EE, Rashid AJ, Kim H, Park S, Santoro A, Frankland PW, Iyer SM, Pak S, Ährlund-Richter S, Delp SL, Malenka RC, Josselyn SA, Carlén M, Hegemann P, Deisseroth K. 2016. Structural foundations of optogenetics: Determinants of channelrhodopsin ion selectivity. <em>Proceedings of the National Academy of Sciences of the United States of America</em> <strong>113</strong>:822–829. doi:<a href="https://doi.org/10.1073/pnas.1523341113">10.1073/pnas.1523341113</a>
</div>
<div id="ref-bogdanchikov13" class="csl-entry" role="doc-biblioentry">
Bogdanchikov A, Zhaparov M, Suliyev R. 2013. Python to learn programmingJournal of Physics: Conference Series. IOP Publishing. p. 012027. doi:<a href="https://doi.org/10.1088/1742-6596/423/1/012027">10.1088/1742-6596/423/1/012027</a>
</div>
<div id="ref-buzsaki12" class="csl-entry" role="doc-biblioentry">
Buzsáki G, Anastassiou CA, Koch C. 2012. The origin of extracellular fields and currents — EEG, ECoG, LFP and spikes. <em>Nature Reviews Neuroscience 2012 13:6</em> <strong>13</strong>:407–420. doi:<a href="https://doi.org/10.1038/nrn3241">10.1038/nrn3241</a>
</div>
<div id="ref-chuong14" class="csl-entry" role="doc-biblioentry">
Chuong AS, Miri ML, Busskamp V, Matthews GAC, Acker LC, Sørensen AT, Young A, Klapoetke NC, Henninger MA, Kodandaramaiah SB, Ogawa M, Ramanlal SB, Bandler RC, Allen BD, Forest CR, Chow BY, Han X, Lin Y, Tye KM, Roska B, Cardin JA, Boyden ES. 2014. Noninvasive optical inhibition with a red-shifted microbial rhodopsin. <em>Nature Neuroscience</em> <strong>17</strong>:1123–1129. doi:<a href="https://doi.org/10.1038/nn.3752">10.1038/nn.3752</a>
</div>
<div id="ref-davison09" class="csl-entry" role="doc-biblioentry">
Davison AP, Hines ML, Muller E. 2009. Trends in programming languages for neuroscience simulations. <em>Frontiers in Neuroscience</em> <strong>3</strong>:374–380. doi:<a href="https://doi.org/10.3389/neuro.01.036.2009">10.3389/neuro.01.036.2009</a>
</div>
<div id="ref-evans16" class="csl-entry" role="doc-biblioentry">
Evans BD, Jarvis S, Schultz SR, Nikolic K. 2016. PyRhO: A Multiscale Optogenetics Simulation Platform. <em>Frontiers in Neuroinformatics</em> <strong>10</strong>:8. doi:<a href="https://doi.org/10.3389/fninf.2016.00008">10.3389/fninf.2016.00008</a>
</div>
<div id="ref-foutz12" class="csl-entry" role="doc-biblioentry">
Foutz TJ, Arlow RL, Mcintyre CC. 2012. Theoretical principles underlying optical stimulation of a channelrhodopsin-2 positive pyramidal neuron. <em>J Neurophysiol</em> <strong>107</strong>:3235–3245. doi:<a href="https://doi.org/10.1152/jn.00501.2011.-Optogenetics">10.1152/jn.00501.2011.-Optogenetics</a>
</div>
<div id="ref-gerstner14" class="csl-entry" role="doc-biblioentry">
Gerstner W, Kistler WM, Naud R, Paninski L. 2014. Neuronal dynamics: From single neurons to networks and models of cognition. Cambridge University Press. doi:<a href="https://doi.org/10.1017/CBO9781107447615">10.1017/CBO9781107447615</a>
</div>
<div id="ref-govorunova15" class="csl-entry" role="doc-biblioentry">
Govorunova EG, Sineshchekov OA, Janz R, Liu X, Spudich JL. 2015. Natural light-gated anion channels: A family of microbial rhodopsins for advanced optogenetics. <em>Science</em> <strong>349</strong>:647–650. doi:<a href="https://doi.org/10.1126/science.aaa7484">10.1126/science.aaa7484</a>
</div>
<div id="ref-govorunova17" class="csl-entry" role="doc-biblioentry">
Govorunova EG, Sineshchekov OA, Rodarte EM, Janz R, Morelle O, Melkonian M, Wong GKS, Spudich JL. 2017. The Expanding Family of Natural Anion Channelrhodopsins Reveals Large Variations in Kinetics, Conductance, and Spectral Sensitivity. <em>Scientific Reports</em> <strong>7</strong>:1–10. doi:<a href="https://doi.org/10.1038/srep43358">10.1038/srep43358</a>
</div>
<div id="ref-gradinaru10" class="csl-entry" role="doc-biblioentry">
Gradinaru V, Zhang F, Ramakrishnan C, Mattis J, Prakash R, Diester I, Goshen I, Thompson KR, Deisseroth K. 2010. Molecular and Cellular Approaches for Diversifying and Extending Optogenetics. <em>Cell</em> <strong>141</strong>:154–165. doi:<a href="https://doi.org/10.1016/j.cell.2010.02.037">10.1016/j.cell.2010.02.037</a>
</div>
<div id="ref-gunaydin10" class="csl-entry" role="doc-biblioentry">
Gunaydin LA, Yizhar O, Berndt A, Sohal VS, Deisseroth K, Hegemann P. 2010. Ultrafast optogenetic control. <em>Nature Neuroscience</em> <strong>13</strong>:387–392. doi:<a href="https://doi.org/10.1038/nn.2495">10.1038/nn.2495</a>
</div>
<div id="ref-gupta19a" class="csl-entry" role="doc-biblioentry">
Gupta N, Bansal H, Roy S. 2019. Theoretical optimization of high-frequency optogenetic spiking of red-shifted very fast-Chrimson-expressing neurons. <em>Neurophotonics</em> <strong>6</strong>:1. doi:<a href="https://doi.org/10.1117/1.nph.6.2.025002">10.1117/1.nph.6.2.025002</a>
</div>
<div id="ref-hagen18" class="csl-entry" role="doc-biblioentry">
Hagen E, Næss S, Ness TV, Einevoll GT. 2018. Multimodal modeling of neural network activity: Computing LFP, ECoG, EEG, and MEG signals with LFPy 2.0. <em>Frontiers in Neuroinformatics</em> <strong>12</strong>:92. doi:<a href="https://doi.org/10.3389/fninf.2018.00092">10.3389/fninf.2018.00092</a>
</div>
<div id="ref-hines97" class="csl-entry" role="doc-biblioentry">
Hines ML, Carnevale NT. 1997. The NEURON Simulation Environment. <em>Neural Computation</em> <strong>9</strong>:1179–1209. doi:<a href="https://doi.org/10.1162/neco.1997.9.6.1179">10.1162/neco.1997.9.6.1179</a>
</div>
<div id="ref-hochbaum14" class="csl-entry" role="doc-biblioentry">
Hochbaum DR, Zhao Y, Farhi SL, Klapoetke N, Werley CA, Kapoor V, Zou P, Kralj JM, MacLaurin D, Smedemark-Margulies N, Saulnier JL, Boulting GL, Straub C, Cho YK, Melkonian M, Wong GKS, Harrison DJ, Murthy VN, Sabatini BL, Boyden ES, Campbell RE, Cohen AE. 2014. All-optical electrophysiology in mammalian neurons using engineered microbial rhodopsins. <em>Nature Methods</em> <strong>11</strong>:825–833. doi:<a href="https://doi.org/10.1038/NMETH.3000">10.1038/NMETH.3000</a>
</div>
<div id="ref-holt99" class="csl-entry" role="doc-biblioentry">
Holt GR, Koch C. 1999. Electrical interactions via the extracellular potential near cell bodies. <em>Journal of Computational Neuroscience</em> <strong>6</strong>:169–184. doi:<a href="https://doi.org/10.1023/A:1008832702585">10.1023/A:1008832702585</a>
</div>
<div id="ref-johnsen22" class="csl-entry" role="doc-biblioentry">
Johnsen K. 2022. kjohnsen/tklfp: v0.2.0. doi:<a href="https://doi.org/10.5281/zenodo.6787979">10.5281/zenodo.6787979</a>
</div>
<div id="ref-kishi22" class="csl-entry" role="doc-biblioentry">
Kishi KE, Kim YS, Fukuda M, Inoue M, Kusakizako T, Wang PY, Ramakrishnan C, Byrne EFX, Thadhani E, Paggi JM, Matsui TE, Yamashita K, Nagata T, Konno M, Quirin S, Lo M, Benster T, Uemura T, Liu K, Shibata M, Nomura N, Iwata S, Nureki O, Dror RO, Inoue K, Deisseroth K, Kato HE. 2022. Structural basis for channel conduction in the pump-like channelrhodopsin ChRmine. <em>Cell</em> <strong>185</strong>:672–689.e23. doi:<a href="https://doi.org/10.1016/j.cell.2022.01.007">10.1016/j.cell.2022.01.007</a>
</div>
<div id="ref-klapoetke14" class="csl-entry" role="doc-biblioentry">
Klapoetke NC, Murata Y, Kim SS, Pulver SR, Birdsey-Benson A, Cho YK, Morimoto TK, Chuong AS, Carpenter EJ, Tian Z, Wang J, Xie Y, Yan Z, Zhang Y, Chow BY, Surek B, Melkonian M, Jayaraman V, Constantine-Paton M, Wong GKS, Boyden ES. 2014. Independent optical excitation of distinct neural populations. <em>Nature Methods</em> <strong>11</strong>:338–346. doi:<a href="https://doi.org/10.1038/nmeth.2836">10.1038/nmeth.2836</a>
</div>
<div id="ref-lin13" class="csl-entry" role="doc-biblioentry">
Lin JY, Knutsen PM, Muller A, Kleinfeld D, Tsien RY. 2013. ReaChR: A red-shifted variant of channelrhodopsin enables deep transcranial optogenetic excitation. <em>Nature Neuroscience</em> <strong>16</strong>:1499–1508. doi:<a href="https://doi.org/10.1038/nn.3502">10.1038/nn.3502</a>
</div>
<div id="ref-mager18" class="csl-entry" role="doc-biblioentry">
Mager T, Morena DLDL, Senn V, Schlotte J, Derrico A, Feldbauer K, Wrobel C, Jung S, Bodensiek K, Rankovic V, Browne L, Huet A, Jüttner J, Wood PG, Letzkus JJ, Moser T, Bamberg E. 2018. High frequency neural spiking and auditory signaling by ultrafast red-shifted optogenetics. <em>Nature Communications</em> <strong>9</strong>:1–14. doi:<a href="https://doi.org/10.1038/s41467-018-04146-3">10.1038/s41467-018-04146-3</a>
</div>
<div id="ref-mazzoni15a" class="csl-entry" role="doc-biblioentry">
Mazzoni A, Lindén H, Cuntz H, Lansner A, Panzeri S, Einevoll GT. 2015. Computing the Local Field Potential (LFP) from Integrate-and-Fire Network Models. <em>PLOS Computational Biology</em> <strong>11</strong>:e1004584. doi:<a href="https://doi.org/10.1371/JOURNAL.PCBI.1004584">10.1371/JOURNAL.PCBI.1004584</a>
</div>
<div id="ref-moldakarimov18" class="csl-entry" role="doc-biblioentry">
Moldakarimov S, Bazhenov M, Feldman DE, Sejnowski TJ. 2018. Structured networks support sparse traveling waves in rodent somatosensory cortex. <em>Proceedings of the National Academy of Sciences of the United States of America</em> <strong>115</strong>:5277–5282. doi:<a href="https://doi.org/10.1073/pnas.1710202115">10.1073/pnas.1710202115</a>
</div>
<div id="ref-muller15" class="csl-entry" role="doc-biblioentry">
Muller E, Bednar JA, Diesmann M, Gewaltig MO, Hines M, Davison AP. 2015. Python in neuroscience. <em>Frontiers in Neuroinformatics</em> <strong>9</strong>:11. doi:<a href="https://doi.org/10.3389/fninf.2015.00011">10.3389/fninf.2015.00011</a>
</div>
<div id="ref-nason20" class="csl-entry" role="doc-biblioentry">
Nason SR, Vaskov AK, Willsey MS, Welle EJ, An H, Vu PP, Bullard AJ, Nu CS, Kao JC, Shenoy KV, Jang T, Kim H-S, Blaauw D, Patil PG, Chestek CA. 2020. A low-power band of neuronal spiking activity dominated by local single units improves the performance of brain–machine interfaces. <em>Nature Biomedical Engineering 2020</em> 1–11. doi:<a href="https://doi.org/10.1038/s41551-020-0591-0">10.1038/s41551-020-0591-0</a>
</div>
<div id="ref-parasuram16" class="csl-entry" role="doc-biblioentry">
Parasuram H, Nair B, D’Angelo E, Hines M, Naldi G, Diwakar S. 2016. Computational modeling of single neuron extracellular electric potentials and network local field potentials using LFPsim. <em>Frontiers in Computational Neuroscience</em> <strong>10</strong>:65. doi:<a href="https://doi.org/10.3389/fncom.2016.00065">10.3389/fncom.2016.00065</a>
</div>
<div id="ref-pettersen12" class="csl-entry" role="doc-biblioentry">
Pettersen KH, Lindén H, Dale AM, Einevoll GT. 2012. Extracellular spikes and CSD. <em>Handbook of neural activity measurement</em> <strong>1</strong>:92–135.
</div>
<div id="ref-saran18" class="csl-entry" role="doc-biblioentry">
Saran S, Gupta N, Roy S. 2018. Theoretical analysis of low-power fast optogenetic control of firing of Chronos-expressing neurons. <em>Neurophotonics</em> <strong>5</strong>:1. doi:<a href="https://doi.org/10.1117/1.nph.5.2.025009">10.1117/1.nph.5.2.025009</a>
</div>
<div id="ref-sridharan22" class="csl-entry" role="doc-biblioentry">
Sridharan S, Gajowa MA, Ogando MB, Jagadisan UK, Abdeladim L, Sadahiro M, Bounds HA, Hendricks WD, Turney TS, Tayler I, Gopakumar K, Oldenburg IA, Brohawn SG, Adesnik H. 2022. High-performance microbial opsins for spatially and temporally precise perturbations of large neuronal networks. <em>Neuron</em> <strong>110</strong>:1139–1155.e6. doi:<a href="https://doi.org/10.1016/j.neuron.2022.01.008">10.1016/j.neuron.2022.01.008</a>
</div>
<div id="ref-stimberg19" class="csl-entry" role="doc-biblioentry">
Stimberg M, Brette R, Goodman DFM. 2019. Brian 2, an intuitive and efficient neural simulator. <em>eLife</em> <strong>8</strong>. doi:<a href="https://doi.org/10.7554/eLife.47314">10.7554/eLife.47314</a>
</div>
<div id="ref-telenczuk20" class="csl-entry" role="doc-biblioentry">
Telenczuk B, Telenczuk M, Destexhe A. 2020. A kernel-based method to calculate local field potentials from networks of spiking neurons. <em>Journal of Neuroscience Methods</em> <strong>344</strong>:108871. doi:<a href="https://doi.org/10.1016/j.jneumeth.2020.108871">10.1016/j.jneumeth.2020.108871</a>
</div>
<div id="ref-thornton19" class="csl-entry" role="doc-biblioentry">
Thornton C, Hutchings F, Kaiser M. 2019. The virtual electrode recording tool for extracellular potentials (VERTEX) Version 2.0: Modelling in vitro electrical stimulation of brain tissue. <em>Wellcome Open Research</em> <strong>4</strong>. doi:<a href="https://doi.org/10.12688/wellcomeopenres.15058.1">10.12688/wellcomeopenres.15058.1</a>
</div>
<div id="ref-tomsett15" class="csl-entry" role="doc-biblioentry">
Tomsett RJ, Ainsworth M, Thiele A, Sanayei M, Chen X, Gieselmann MA, Whittington MA, Cunningham MO, Kaiser M. 2015. Virtual Electrode Recording Tool for EXtracellular potentials (VERTEX): comparing multi-electrode recordings from simulated and biological mammalian cortical tissue. <em>Brain Structure and Function</em> <strong>220</strong>:2333–2353. doi:<a href="https://doi.org/10.1007/s00429-014-0793-x">10.1007/s00429-014-0793-x</a>
</div>
<div id="ref-vierock21" class="csl-entry" role="doc-biblioentry">
Vierock J, Rodriguez-Rozada S, Dieter A, Pieper F, Sims R, Tenedini F, Bergs ACF, Bendifallah I, Zhou F, Zeitzschel N, Ahlbeck J, Augustin S, Sauter K, Papagiakoumou E, Gottschalk A, Soba P, Emiliani V, Engel AK, Hegemann P, Wiegert JS. 2021. BiPOLES is an optogenetic tool developed for bidirectional dual-color control of neurons. <em>Nature Communications</em> <strong>12</strong>:1–20. doi:<a href="https://doi.org/10.1038/s41467-021-24759-5">10.1038/s41467-021-24759-5</a>
</div>
<div id="ref-wilmes19" class="csl-entry" role="doc-biblioentry">
Wilmes KA, Clopath C. 2019. Inhibitory microcircuits for top-down plasticity of sensory representations. <em>Nat Commun</em> <strong>10</strong>:5055. doi:<a href="https://doi.org/10.1038/s41467-019-12972-2">10.1038/s41467-019-12972-2</a>
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./background.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Background</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./aim2.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Aim 2: Multi-input CLOC</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","openEffect":"zoom","loop":true,"descPosition":"bottom","selector":".lightbox"});</script>



</body></html>